<!DOCTYPE html>
<!--suppress ALL -->
<html lang=pt>
<head>
    <title>Hello Firebase Login</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="styles.css">
    <script src="https://www.gstatic.com/firebasejs/3.2.0/firebase.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://use.fontawesome.com/9459e1215b.js"></script>
</head>

<body>
<div id="login" class="cartao">
    <div class="login cartao">
        <img src="google_firebase-2-128.png">
        <h1>Bem vindo ao Firebase Login</h1>
        <button onclick="facebookLogin()" class="face"><i class="fa fa-facebook-square" aria-hidden="true"></i>Entrar
            com <b>Facebook</b></button>
        <button onclick="googleLogin()" class="google"><i class="fa fa-google" aria-hidden="true"></i>Entrar com Google
        </button>
        <button onclick="anonimoLogin()" class="anonimo"><i class="fa fa-user" aria-hidden="true"></i>Entrar como
            Anônimo
        </button>

    </div>
    <span class="overlay"></span>
</div>

<div class="firelogin hide cartao">
    <div>
        <img class="avatar" id="foto">
        <h1 id="username"></h1>
        <h3 id="email"></h3>
    </div>
    <div style="margin-top: 50px">
        <img src="google_firebase-2-128.png">
        <h4>Seja bem vindo ao</h4>
        <p>Firebase Login <i id="iconLogado" class="fa" aria-hidden="true"></i></p>
        <button class="logout" onclick="logout()"><i class="fa fa-sign-out" aria-hidden="true"></i> Sair</button>
    </div>

</div>
<script>
    var config = {
        apiKey: "AIzaSyAOlL5BIsqbuCT1C3KnJQUY14J1UcUmbgg",
        authDomain: "hello-fb-login.firebaseapp.com",
        databaseURL: "https://hello-fb-login.firebaseio.com",
        storageBucket: "hello-fb-login.appspot.com"
    };

    function logout() {
        firebase.auth().signOut();
        $(".firelogin").addClass("hide");
        $("#login").removeClass("hide");
    }

    function facebookLogin() {
        console.log("Entrando com Facebook...");
        var provider = new firebase.auth.FacebookAuthProvider();
        var me = this;

        firebase.auth().signInWithPopup(provider).then(function (result) {
            $("#iconLogado").addClass("fa-facebook-square");
            $("#iconLogado").removeClass("fa-google fa-user");
            $("#username").text(result.user.displayName);
            $("#email").text(result.user.email);
            $("#foto").attr("src", result.user.photoURL);
            $(".firelogin").removeClass("hide");
            $("#login").addClass("hide");

        }).catch(function (error) {
            console.error("ERRO: " + error.code);
            console.error("Falha ao logar: " + error);
        });
    }

    function googleLogin() {
        console.debug("Entrando com Google...");
        var provider = new firebase.auth.GoogleAuthProvider();
        var me = this;
        firebase.auth().signInWithPopup(provider).then(function (result) {
            $("#iconLogado").addClass("fa-google");
            $("#iconLogado").removeClass("fa-facebook-square fa-user");
            $("#username").text(result.user.displayName);
            $("#email").text(result.user.email);
            $("#foto").attr("src", result.user.photoURL);
            $(".firelogin").removeClass("hide");
            $("#login").addClass("hide");
        }).catch(function (error) {
            console.error("Falha ao logar: " + error);
        });
    }

    function anonimoLogin() {
        console.debug("Entrando Anônimamente...");
        firebase.auth().signInAnonymously().catch(function (error) {
            console.error("Falha ao logar: " + error);
        });

        firebase.auth().onAuthStateChanged(function (user) {
            if (user && user.isAnonymous) {
                $("#iconLogado").addClass("fa-user");
                $("#iconLogado").removeClass("fa-facebook-square fa-google");
                $("#username").text("Mistéérioo!");
                $("#email").text("@nonimo");
                $("#foto").attr("src", "https://scontent.fcpq1-1.fna.fbcdn.net/v/t1.0-1/c15.15.190.190/s160x160/482865_107766019411218_1824143669_n.jpg?oh=233c546aafa3f867c19151aebe803804&oe=582AB1AD");
                $(".firelogin").removeClass("hide");
                $("#login").addClass("hide");
            } else if (!user) {
                console.log("Deslogou");
            }
        });
    }

    window.onload = function () {
        firebase.initializeApp(config);
    };
</script>
</body>
</html>
